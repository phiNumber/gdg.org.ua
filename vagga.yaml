containers:
  gdg_dev:
    setup:
      - !Ubuntu trusty
      - !UbuntuUniverse
      - !AptTrust keys: [5BB92C09DB82666C]
      - !UbuntuPPA fkrull/deadsnakes
      - !BuildDeps
        - git
        - curl
        - wget
        - mercurial
      - !Install
        - software-properties-common
        - python3.5
        - python3.5-dev
        - openssl
        - libssl-dev
        - libpq-dev
        - ca-certificates
        - build-essential
      - !PipConfig
        dependencies: true
        python-exe: python3.5
      - !Depends requirements/common.txt  # As to https://github.com/tailhook/vagga/issues/236
      - !Py3Requirements requirements/dev.txt
      - !NpmInstall [bower]
      - !EnsureDir /var/tmp/run
    environ:
      APP_ROOT: /work  # Make sure this is not overriden by .exports
    volumes:
      /var/tmp/run: !Tmpfs
        size: 5Mi
        mode: 0o1777

commands:
  run: !Supervise
  description: Run app - testing status
  children:
    env: !Command
    container: gdg_dev
    run: |
      make run-dev
